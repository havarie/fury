"use strict";var functions=require("firebase-functions"),admin=require("firebase-admin"),serviceAccount=require("./diary-7919f-firebase-adminsdk-xp9f8-c1c1052d38.json"),app=admin.initializeApp({credential:admin.credential.cert(serviceAccount),databaseURL:"https://diary-7919f.firebaseio.com"}),db=admin.firestore(app),cors=require("cors")({origin:!0}),express=require("express"),appMemories=express(),authenticate=function(r,t,i){if(!r.headers.authorization||!r.headers.authorization.startsWith("Bearer "))return console.log("Unauthorized"),void t.status(203).json({error:{message:"No authorization information sent.",status:"UNAUTHENTICATED"},message:"No authorization information sent."});var e=r.headers.authorization.substring("Bearer ".length);admin.auth().verifyIdToken(e).then(function(e){return r.uid=e.uid,i()}).catch(function(e){console.log("Error, prob not authenticated"),t.status(203).json({error:{message:"Not authorized",status:"UNAUTHENTICATED"},message:"Not authorized"})})};appMemories.use(authenticate),appMemories.post("/newVideo",function(e,r){cors(e,r,function(){return r.status(200).json({isError:!1,signedUrl:url})})}),exports.addVideo=functions.https.onRequest(function(e,r){db.collection("memories").add({owner:"Tokyo",country:"Japan"})});